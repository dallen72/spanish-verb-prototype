# ================================================================================================================
# PULL REQUEST BUILD - VERIFICATION ONLY
# ================================================================================================================
# 
# PURPOSE: Verifies that pull requests can build successfully without deploying
# TRIGGER: Runs on every pull request to main/master branches
# BUILD MODE: Debug builds (faster compilation, includes debug symbols)
# OUTPUT: Build verification only - no deployment to Itch.io
# 
# This workflow:
# - Validates all GDScript files for parse errors
# - Builds the game for all platforms (Windows, Linux, macOS, Web)
# - Verifies that all builds completed successfully
# - Provides feedback on PR build status
# - Does NOT upload builds to Itch.io (only main branch pushes do that)
# 
# Use this workflow to:
# - Catch script parse errors before building
# - Verify PR changes don't break the build
# - Catch build errors before merging to main
# - Ensure all platforms compile successfully
# ================================================================================================================

name: PR Build Verification
on:
  pull_request:
    branches: [ main, master ]
env:
  GODOT_VERSION: 4.5

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/dallen72/godot-ci-extended:4.5
    steps:
      - uses: actions/checkout@v5
        with:
          clean: true  # Force clean checkout
      
      - name: Build Full Game (Debug)
        uses: ./.github/actions/build-game
        with:
          build-mode: debug
          project-name: ${{ vars.PROJECTNAME }}
          web-build: ${{ vars.WEBBUILD || 'true' }}
          linux-build: ${{ vars.LINUXBUILD || 'false' }}
          macos-build: ${{ vars.MACOSBUILD || 'false' }}
          windows-build: ${{ vars.WINDOWSBUILD || 'true' }}
      
      - name: Verify Build Output
        uses: ./.github/actions/verify-build
        with:
          build-mode: debug
          project-name: ${{ vars.PROJECTNAME }}
          web-build: ${{ vars.WEBBUILD || 'true' }}
          linux-build: ${{ vars.LINUXBUILD || 'false' }}
          macos-build: ${{ vars.MACOSBUILD || 'false' }}
          windows-build: ${{ vars.WINDOWSBUILD || 'true' }}
