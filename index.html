
<!DOCTYPE html>
<html>
<head>
<style>
  .excercise {
    max-width: 44rem;
    margin: auto;
  }
  .excerciseTwo {
    display: none;
  }
  div.gameContainer div.pronoun.section,
  div.gameContainer div.divider,
  div.gameContainer div.conjugation.section {
    display: inline-block;
    vertical-align: top;
  }
  body {
    background-color: lightgray;
  }
  div.gameContainer div.cell {
    cursor: pointer;
    background-color: yellow;
    padding: 1rem;
    margin: 2px;
    flex-basis: 100%;
    text-align: center;
    border-radius: 12px;
   }
  div.gameContainer div.cell.selected {
    background-color: green;
  }
  div.gameContainer div.cell.correct {
    background-color: lightblue;
  }
  div.gameContainer div.row {
    display: block;
    width: 18rem;
    display: flex;
  }
  .popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 20px;
    border-radius: 5px;
    display: none;
    opacity: 0;
    transition: opacity 1s ease-in-out;
  }

  /* For when the popup is visible */
  .popup.show {
      display: block;
      opacity: 1;
  } 
</style>
  <script>
    let selectedPronoun;
    let selectedConjugation;
    let previousScore = 0;

    let verbList = [
      {
      name: "Tener",
      conjugations: {yo: "tengo",
        tu: "tienes",
        el: "tiene",
        nosotros: "tenemos",
        vosotros: "ten√©is",
        ellos: "tienen"},
      },
      {
        name: "Hablar",
        conjugations: {
          yo: "hablo",
          tu: "hablas",
          el: "habla",
          nosotros: "hablamos",
          vosotros: "hablais",
          ellos: "hablan"
        }
      },
      {
        name: "vivir",
        conjugations: {
          yo: "vivo",
          tu: "vives",
          el: "vive",
          nosotros: "vivimos",
          vosotros: "vivis",
          ellos: "viven"
        }
      }
    ];

    let completedVerbs = []
    let verb = verbList[ Math.floor(Math.random() * verbList.length) ]


    /*
     * show the first excercise
     */
    function goToExcerciseOne() {
      document.querySelector('.excerciseOne').style.display = 'block';
      document.querySelector('.excerciseTwo').style.display = 'none';
    }


    /* 
     * show the second excercise
     */
    function goToExcerciseTwo() {
      document.querySelector('.excerciseOne').style.display = 'none';
      document.querySelector('.excerciseTwo').style.display = 'block';
    }


    /*
     * main function to run when the page is loaded
     */
    document.addEventListener("DOMContentLoaded", function(event) { 
      // init pronoun part of game board
      for (let i = 0; i < Object.keys(verb.conjugations).length; i++) {
        let conjugation = verb.conjugations[i];
        for (let key in conjugation) {
          let value = conjugation[key];
          let keyName = getKeyByValue(conjugation, value);
          let element = document.querySelector('.' + key + '-conjugate');
          element.innerHTML = value;
        }
      }
    });


    /*
     * handle click event for pronoun buttons
     */
    function handleClickPronoun(event) {
      selectedPronoun = event.target.innerHTML.split("...")[0];
      if (selectedConjugation != null) {
        if (verb.conjugations[selectedPronoun] == selectedConjugation) {
          showTheMatch(event.target);
          if (allAreMatched()) {
            showPopup();
            getNextProblem();
            // TODO: rename the excercises, matchingExcercise and sentenceFillInBlank excercise
            // TODO: make sentenceMatchingExcercise. this shows first. this is a one sentence per excercise. the conjugation score is determined from this. also verb and ending.
            // when the user gets this right, the next excercise is shown.
            // TODO: make fillInBlankExcercise. this shows second. this is a sentence with a blank verb. this effects conjugation score.  also verb and ending scores.
            // scoring: the total number wrong. compare to other categories (verb, conjugation, excercise)
                // when the total wrong for the conjugation is zero (ending, verb, conjugation same) is zero, the verb conjugation changes and the first excercise is shown. if the total wrong for all conjugations are each zero for the verb, the verb changes. and the first excercise is shown again. if the total wrong for all verbs is zero, the excercise changes to the word matching excercise. . 
              // for the word matching excercise, if the total wrong for all verbs is zero, the verb ending changes, along with the verb and conjugation, and the first excercise is shown again. if the total wrong for all endings is zero, a "congratulations, you won!" message is shown.

            // step 1. shows first problem
            // step 2. after completing, new score is calculated. then if the problem is 2 or more below the best score, the problem is shown again. if the problem is 1 below the best score, the next problem is shown.
            // but there is a score for the problem, the verb, and the verb ending. so there is a score associated with the actual problem, the score associated with the verb, and the score associated with the verb ending.
            // TODO: a data structure for this
            // TODO: an algorithm for this
          }
          selectedConjugation = null;
          selectedPronoun = null;
          return;
        } else {
          previousScore += 1;
        }
      }

      const buttons = document.querySelectorAll('.cell');
      highlightOnlyOne(buttons, event.target);
      selectedPronoun = event.target.innerHTML.split('...')[0];
    }


    /*
     * change the buttons of the matched element 
     */
    function showTheMatch(element) {
      document.querySelector(".cell.selected").classList.add("correct");
      document.querySelector(".cell.selected").innerHTML = selectedPronoun + " " + selectedConjugation;
      document.querySelector(".cell.selected").classList.remove("selected");

      element.classList.add("correct");
      element.innerHTML = selectedPronoun + " " + selectedConjugation;
    }


    /*
     * check if all the verb conjugations are matched
     */
    function allAreMatched() {
      return document.querySelectorAll(".cell.correct").length >= 12;
    }


    /*
     * set a new verb for the next problem
     */
    function getNextProblem() {
      let completedVerbs = []
      completedVerbs.push(verb.name);
      while (completedVerbs.includes(verb.name)) {
        verb = verbList[ Math.floor(Math.random() * verbList.length) ]
      }

      updatePreviousScoreElement();

      generateConjugationGameElements(verb);
    }


    /*
     * update the text for information on the last problem
     */
    function updatePreviousScoreElement() {
      document.querySelector("h2.previousScore").innerHTML = "You got " + previousScore + " wrong on the last problem";
    }


    /*
     * handle click event for conjugation buttons
     */
    function handleClickConjugation(event) {
      selectedConjugation = event.target.innerHTML;
      if (selectedPronoun != null) {
        if (verb.conjugations[selectedPronoun] == selectedConjugation) {
          showTheMatch(event.target);
          if (allAreMatched()) {
            showPopup();
            getNextProblem();
          }
          selectedConjugation = null;
          selectedPronoun = null;
          return;
        } else {
          previousScore += 1;
        }
      }

      const buttons = document.querySelectorAll('.cell');
      highlightOnlyOne(buttons, event.target);
      selectedConjugation = event.target.innerHTML;
    }


    /*
     * highlight only one button and remove highlight from all others
     * @param target - the button to highlight
     * @param buttons - the list of all buttons to remove highlight from
     */
    function highlightOnlyOne(buttons, target) {
      // Remove highlight class from all buttons
      buttons.forEach(button => {
          button.classList.remove('selected');
      });

      // Add highlight class to target
      target.classList.add('selected');
    }


    /*
     * get the key of an object by its value
     * @param object - the object to search
     * @param value - the value to search for
     * @return the key of the object
     */
    function getKeyByValue(object, value) {
      return Object.keys(object).find(key => object[key] === value);
    }


    /*
     * generate the conjugation game html elements
     * @param _verb - the verb to generate the elements for
     */
    function generateConjugationGameElements(_verb) {
      document.querySelector('h2.verblabel').innerHTML = verb.name;

      let conjugationElements = document.querySelectorAll("div.conjugation.section div.cell");
      if (conjugationElements.length > 0) {
        for (let i = 0; i<conjugationElements.length; i++) {
          conjugationElements[i].remove();
        }
      }
      let pronounElements = document.querySelectorAll("div.cell.correct");
      for (let i = 0; i<pronounElements.length; i++) {
        pronounElements[i].innerHTML = pronounElements[i].innerHTML.split(" ")[0];
        pronounElements[i].classList.remove("correct");
      }
      let elementList = []
      for (let i = 0; i < Object.keys(_verb.conjugations).length; i++) {
        let conjugation = _verb.conjugations[Object.keys(_verb.conjugations)[i]];
        let keyName = getKeyByValue(_verb.conjugations, conjugation);
        let element = document.querySelector("." + Object.keys(_verb.conjugations)[i] + "-conjugate");
        let cellElement = document.createElement('div');
        cellElement.classList.add('cell');
        cellElement.classList.add(keyName + '-conjugate');
        cellElement.classList.add('conjugate');
        cellElement.innerHTML = conjugation;
        cellElement.onclick = function(event) {
          handleClickConjugation(event);
        }
        elementList.push(cellElement);
      }
      const randomizedList = elementList.sort(() => Math.random() - 0.5);
      for (let element in randomizedList) {
        document.querySelector("div.conjugation.section").appendChild(randomizedList[element]);
      }
    }


    /*
     * show the temporary popup
     */
    function showPopup() {
        const popup = document.getElementById('popup');

        // Show the popup with fade-in effect
        popup.classList.add('show');

        // After 2 seconds, fade out the popup
        setTimeout(function() {
            popup.classList.remove('show');
        }, 2000); // 2000 ms = 2 seconds
    }


  </script>
</head>
<body>
  <div class="gameContainer">
    <div class="excercise excerciseOne">
      <h2>Match the conjugation with the pronoun for...</h2>
      <h2 class="verblabel"></h2>


      <div class="pronoun section">
        <div class="row">
          <div class="cell pronoun yo" onclick="handleClickPronoun(event)">yo...</div>
          <div class="cell pronoun tu" onclick="handleClickPronoun(event)">tu...</div>
          <div class="cell pronoun el" onclick="handleClickPronoun(event)">el...</div>
        </div>
        <div class="row">
          <div class="cell pronoun nosotros" onclick="handleClickPronoun(event)">nosotros...</div>
          <div class="cell pronoun vosotros" onclick="handleClickPronoun(event)">vosotros...</div>
          <div class="cell pronoun ellos" onclick="handleClickPronoun(event)">ellos...</div>
        </div>
      </div>
      <div class="divider">
        <h2><- Click to Match -></h2>
      </div>
      <div class="conjugation section">
          <script>
            generateConjugationGameElements(verb);
          </script>
      </div>
      <h2 class="previousScore">
      </h2>
      <div>
        <h2 class="goToExcerciseTwo"><a href="#" onclick="goToExcerciseTwo(); return false;">Go to next excercise-></a></h2>
      </div>
      <div id="popup" class="popup">
        Good Job!
      </div>
    </div>


    <div class="excercise excerciseTwo">
      <div>
        <h2 class="goToExcerciseOne"><a href="#" onclick="goToExcerciseOne(); return false;">Go to next excercise-></a></h2>
      </div>
    </div>


  </div>
</body>
</html>
